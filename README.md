# Тренировки по DevOps
Это репозиторий с автоматизационными скриптами по итоговой работе.
Использованы материалы из решения домашней работы по облакам и другим (спасибо им), основа взята из репозитория krya-kryak/y-y-devops-trainings-cloud-1
В проекте участвуют: база данных PostgreSQL, две облачные виртуалки (coi), load-balancer.
##  Начальные разбирательства (на локальном компе)
Попробовать начально запустить бинарник решила на домашнем компе. Скачала, сделала запускаемым (`chmod +x bingo`), запустила, почему-то сразу с опцией --help (потом только узнала, что bingo пишет "Hello world", если запустить без опций). Из help понятно стало, что нужна база данных (олпция prepare_db), а для базы надо куда-то подключаться, то есть нужен конфиг, решила что надо вывести default конфиг (`./bingo print_default_config`), чтобы понять хотя бы в каком формате он должен быть и что там прописывать. Стало понятно, что нужен PostgreSQL, устанавила по инструкции с сайта https://www.postgresql.org/download/linux/ubuntu/, а именно:
`sudo sh -c 'echo "deb https://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'`
`wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -`
`sudo apt-get update`
БД готова и даже дефолтный конфиг мог бы подойти, если бы не было задания - поменять email. Поэтому записываю на удачу дефолный конфиг в файл `./bingo print_default_config > bingo.conf`, меняю email, пробую вывести текущий конфиг (`./bingo print_current_config`). Но эта команда завершилась ошибкой, поэтому решила попробовать разобраться с strace (`./bingo print_current_config`). И, "бинго" (каламбур) разглядела в выводе вот такую строку: `openat(AT_FDCWD, "/opt/bingo/config.yaml", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)`
Что ж, значит надо перенести конфиг в другое место (`sudo mkdir /opt/bingo; sudo chown $USER /opt/bingo; cp bingo.conf /opt/bingo/config.yaml`). Пробую ещё раз `./bingo print_current_config` и получаю конфиг с моим email. Теперь из списка опций понятно, что надо залить данные в БД (опция prepare_db), запускаю `./bingo prepare_db` жду завершения.
После - пытаюсь запустить сервер `./bingo run_server`, но при запуске опять получаю ошибку, с которой разбираюсь strace-ом и вижу, что bingo пытается получить доступ к файлу `/opt/bongo/logs/ab8c751b93/main.log`, очевидно собирается писать в него логи. Создаю иерархию каталогов, сам файл, делаю $USER владельцем директории `/opt/bingo` и файла.
Запускаю `./bingo run_server` - 

Но так как ему нужна база данных, а не хотелось PostgreSQL устанавливать в родную операционку, то перенесла бинарник в виртуальную машину, благо была уже создана у меня виртуалка с установленной Ubuntu.

На неё же установила PostgreSQL

## Запуск в облаке
### Разворачивание PostgreSQL
#### Виртуалка в облаке
1. Создала диск для данных (20Гб - достаточно, его буду монтировать в /var/lib/postgresql)
2. Создала виртуалку (создавала несколько раз, с повышением ресурсов, потому что боролась с непроходящими тестами по отказоустойчивости)